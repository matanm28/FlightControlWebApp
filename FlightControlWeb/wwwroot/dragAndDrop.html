<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="css/dragAndDropStyle.css">
    <meta charset="utf-8"/>
    <title></title>
</head>
<body>
    <script>
        let dropArea = document.getElementById('drop-area');
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            dropArea.addEventListener(eventName, highlight, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, unhighlight, false);
        });

        function highlight(e) {
            dropArea.classList.add('highlight');
        }

        function unhighlight(e) {
            dropArea.classList.remove('highlight');
        }

        dropArea.addEventListener('drop', handleDrop, false);

        function handleDrop(e) {
            let dt = e.dataTransfer;
            let files = dt.files;

            handleFiles(files);
        }

        function handleFiles(files) {
            ([...files]).forEach(uploadFile);
        }

        function uploadFile(file) {
            let url = 'YOUR URL HERE';
            let formData = new FormData();

            formData.append('file', file);

            fetch(url,
                {
                    method: 'POST',
                    body: formData
                })
                .then(() => {
                    alert("file uploaded");
                })
                .catch(() => { alert("failed to upload file"); })
        }

        function uploadFile(file) {
            var url = 'YOUR URL HERE';
            var xhr = new XMLHttpRequest();
            var formData = new FormData();
            xhr.open('POST', url, true);

            xhr.addEventListener('readystatechange',
                function (e) {
                    if (xhr.readyState == 4 && xhr.status == 200) {
                        // Done. Inform the user
                    } else if (xhr.readyState == 4 && xhr.status != 200) {
                        // Error. Inform the user
                    }
                })

            formData.append('file', file);
            xhr.send(formData);
        }

        function previewFile(file) {
            let reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onloadend = function () {
                let img = document.createElement('img');
                img.src = reader.result;
                document.getElementById('gallery').appendChild(img);
            }
        }
        function handleFiles(files) {
            files = [...files];
            files.forEach(uploadFile);
            files.forEach(previewFile);
        }

        let filesDone = 0;
        let filesToDo = 0;
        let progressBar = document.getElementById('progress-bar');

        function initializeProgress(numfiles) {
            progressBar.value = 0;
            filesDone = 0;
            filesToDo = numfiles;
        }

        function progressDone() {
            filesDone++;
            progressBar.value = filesDone / filesToDo * 100;
        }
        function handleFiles(files) {
            files = [...files];
            initializeProgress(files.length); // <- Add this line
            files.forEach(uploadFile);
            files.forEach(previewFile);
        }

        function uploadFile(file) {
            let url = 'YOUR URL HERE';
            let formData = new FormData();

            formData.append('file', file);

            fetch(url, {
                    method: 'POST',
                    body: formData
                })
                .then(progressDone) // <- Add `progressDone` call here
                .catch(() => { /* Error. Inform the user */ })
        }

    </script>
    <div id="drop-area">
        <form class="my-form">
            <p>Upload multiple files with the file dialog or by dragging and dropping images onto the dashed region</p>
            <input type="file" id="fileElem" multiple accept="image/*" onchange="handleFiles(this.files)">
            <label class="button" for="fileElem">Select some files</label>
        </form>
    </div>
    <div id="gallery"></div>
<progress id="progress-bar" max=100 value=0></progress>



</body>
</html>